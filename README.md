<h1>Lab Outline: Azure Vulnerability Management</h1>

This project is about vulnerability identification, and subsequent remediation. To do this, I set up a secure Azure network with an OpenVAS Management Scanner VM, and a vulnerable Windows 10 VM, featuring outdated security software and disbaled security controls. I then run both unauthenticated and credentiated scans, highlighting the differences, and remediate the identified vulnerabilities. 

Before starting, create a free [Microsoft Azure account](https://azure.microsoft.com/en-gb) and ensure you are connected to the internet.

<h2>Preparing the Vulnerability Management Scanner</h2>

1. Go to [Azure portal](https://azure.microsoft.com/en-gb/get-started/azure-portal) and log-in using the account just created.
2. Search for "OpenVAS secured and supported by HOSSTED" in the marketplace.
3. Select "Start with a pre-set configuration" and choose the weakest one.
4. Select "Continue to CreateVM" and apply the following settings:
- Resource Group: Vulnerability Management
- VM Name: OpenVAS
- Region: I used (Europe) UK South, but you can select any
- Security type: Standard
- Image: OpenVAS with Support by HOSSTED - x64 Gen1
- VM architecture: x64
5. Create an Azure administrator account
6. Leave the 'Disks', 'Networking' and 'Management' pages as they are. Under 'Monitoring' you can disable boot diagnostics.
7. From the Azure search bar, look for 'Virtual Machines' and select the OpenVAS Server.
8. Copy the Public IP address.
9. Using Terminal (MacOS) or PowerShell (windows), ssh into it using the command `ssh azureuser@IP Address` and the IP address copied from step 8. Log in using the credentials created in step 5.

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/a4dd6f67-15ff-4a22-ae3b-b6614976b467">

The screen should look like this. Make note of the username, admin, and the password displayed. 

10. Using the web app URL displayed, open your browser and attempt to visit the URL. This will take you to the vulnerability management platform. Log in using the username and password just given. If the password does not work, try the password 'admin'. Once logged in, the password can be reset in Settings.

<img width="410" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/44eb9c75-77f8-4f4e-82c5-23117ad9a9cf">\

<h2>Creating a Vulnerable Virtual Machine</h2>

1. Go to [Azure portal](https://azure.microsoft.com/en-gb/get-started/azure-portal), search 'Virtual Machines' and create a new VM.
2. Use the following settings to create the new VM:
- Resource Group: Vulnerability-Management
- VM Name: Win10-Vulnerable
- Region: Same as the OpenVAS VM (Europe UK South)
- Virtual Network: Same as OpenVAS
- Image: Windows 10 Pro
- Size: Any size with 2 vCPUs
- Create a username and password 
- Networking: Same virtual network as OpenVAS VM

3. Download Microsoft Remote Desktop.
4. Search for 'Virtual Machines' in the search bar of Azure and copy the Public IP Address of the 'Win10-Vulnerable' VM just created.
5. Open Microsoft Remote Desktop. If using Windows, paste the IP address in. If using Mac, select create new PC first.
6. Double click on the VM in Microsoft Remote Desktop and log in.

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/3d0ccc7f-2527-472f-bf33-d1f474853f73">

7. After logging into the VM, we will make it vulnerable by disabling the firewall. Make sure you are in the remote desktop, not your host PC. Select Start and search for 'wf.msc'.

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/d728a463-daac-4163-8d39-130f36ba935f">

8. Select 'Windows Defender Firewall Properties'. Under Domain, Public and Private Profile, turn off the firewall state. 

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/6b39e747-8428-4667-acf2-ff86c48d6415">

9. Download and install the old software below to create vulnerabilities on the VM.

[Download Software](https://drive.google.com/drive/u/0/folders/1n83ilCjZWZulbDdYnUe9wQPK2buY47_U)

10. Restart your VM.

<h2>Perform An Unauthenticated Scan</h2>

1. Using the URL copied earlier, log into OpenVAS in a browser on your host computer. Select Assets > Host > New Host and add the Client VM Private IP address.
2. Under actions, create a new target named 'Azure Vulnerable VMs'.

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/cdd84106-7c02-47f2-b826-d77f644b2ef0">

<img width="444" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/56d39cef-01ab-40a8-a46f-874448e34707">

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/64eed9b3-5c8b-43b6-b600-6637c6052d6e">

3. Select Create New Task and apply the following settings. Leave everything else in the default setting.

<img width="468" alt="image" src="https://github.com/miahippisley/Vulnerability-Management-Lab/assets/127256439/ad0aa765-fd5c-4ac5-bdca-6753b3a48a1f">


4. Press Play to start the scan. The OpenVAS Vulnerability Management Scanner will start to perform authenticated scans on the insecure Windows VM with the very outdated software installed.

Once completed, clicking on the report and selecting 'Results' which show you the vulnerabilities detected.


<h2>Peform  Credentiated Scans against the Windows VM</h2>

1. Via Microsoft Remote Desktop, open the Windows VM.
2. Go to Start and search 'wf.msc'. Ensure the firewall is turned off. 
3. Go to Start > Change User Account Control Settings > Never notify
4. Go to Start > services.msc > Remote Registry > Startup type = Automatic > Start 
5. Go to Start > Registory Editor > HKEY_LOCAL_MACHINE > SOFTWARE > Microsoft > Windows > CurrentVersion > Policies > System.
6. Right-click inside of system and create a new DWORD named 'LocalAccountTokenFilterPolicy'. Set its value to one.
7. Restart VM 
<br/>

8. Reopen the OpenVAS web app using the URL provided earlier and log in.
9. Go to Configurations > Credentials > Create new credential
- Name: Azure VM Credentials
- Comment: Azure VM Credentials
- Type: Username + Password
- Allows insecure use: Yes
- Auto-generate: No
- Create username and password

10. Go to Configuration > Targets > Press the sheep icon to clone the 'Azure Vulnerable VMs' target made previously.
11. Edit the cloned target: rename as 'Azure Vulnerable VMs - Credentiated Scan' and scroll down to 'Credentials for authenticated checks' and for SMB select 'Azure VM Credentials'

12. Go to Tasks > clone the previous task. Edit the cloned task, renaming it 'Scan - Azure Vulnerable VMs - Credentiated'. For Scan Targets, select 'Azure Vulnerable VMs - Credentiated Scan'.

13. Press the play button to the start the scan.

This credentiated scan will identify many more vulnerabilities than the unauthenticated scan. 


<h2>Remediate the Vulnerabilities</h2>

1. Enter the Windows VM
2. Select Start > Control Panel > Uninstall the outdated software downloaded earlier. Exit the VM.
3. Perform another credentiated scan to verify vulnerabilities have been remediated.




